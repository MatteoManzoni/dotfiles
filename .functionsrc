#/bin/bash

man() {
    LESS_TERMCAP_md=$'\e[01;31m' \
    LESS_TERMCAP_me=$'\e[0m' \
    LESS_TERMCAP_se=$'\e[0m' \
    LESS_TERMCAP_so=$'\e[01;44;33m' \
    LESS_TERMCAP_ue=$'\e[0m' \
    LESS_TERMCAP_us=$'\e[01;32m' \
    command man "$@"
}

ypull() {
    yadm pull
    yadm update-index --assume-unchanged ~/README.md ~/LICENSE
    [ -f ~/README.md ] && rm ~/README.md
    [ -f ~/LICENSE ] && rm ~/LICENSE
}

ypush() {
    yadm push
    git -C /Users/matteo/Projects/Personal/dotfiles pull --rebase
}

gll(){
    git clone "$(pbpaste)"
}

cfile(){
  cat $1 | pbcopy
}

trash(){
  mv "$@" ~/.Trash
}

fl() {
    grep -rnw . -e "$*"
}

server() {
	local port="${1:-8000}"
	sleep 1 && open "http://localhost:${port}/" &
	python -c $'import SimpleHTTPServer;\nmap = SimpleHTTPServer.SimpleHTTPRequestHandler.extensions_map;\nmap[""] = "text/plain";\nfor key, value in map.items():\n\tmap[key] = value + ";charset=UTF-8";\nSimpleHTTPServer.test();' "$port"
}

wll() {
    curl -O "$(pbpaste)"
}

elmvpn() {
    local PIDFILE_ELMVPN="/tmp/.elmvpn.pid"
    
    if [ "$#" -eq 1 ]; then
        if [ -f "$PIDFILE_ELMVPN" ]; then
            local PID_ELMVPN="$(/bin/cat $PIDFILE_ELMVPN 2>/dev/null)"
        fi
        if [ "$1" == "start" ];then
            if [ "$PID_ELMVPN" == "" ]; then
                sudo /opt/cisco/anyconnect/bin/vpnagentd
                local PID_ELMVPN=$(ps aux | grep vpnagentd | grep -v grep | awk '{print $2}')
                echo "PID:"
                echo "$PID_ELMVPN" | sudo tee $PIDFILE_ELMVPN
                sudo -u matteo open -a Cisco\ AnyConnect\ Secure\ Mobility\ Client
            else
                echo "Anyconnect trojan vpnagentd already running"
                echo "Just start anyconnect gui or even better, kill the trojan! (PID: $PID_ELMVPN)"
            fi
        elif [ "$1" == "clean" ]; then
            if [ "$PID_ELMVPN" != "" ]; then
                PID_GUI_ELMVPN="$(ps aux | grep 'Cisco AnyConnect Secure Mobility Client' | grep -v grep | awk '{print $2}')"
                kill "$PID_GUI_ELMVPN"
                sudo kill "$PID_ELMVPN"
                sudo rm -f "$PIDFILE_ELMVPN"
                echo "100% Trojan Free"
            else
                echo "Missing process PID, maybe already killed?"
            fi
        fi
    else
        echo -e "This command accept:\n\tstart -> start anyconnect VPN trojan and track is PID\n\tclean -> kills the trojan and all anyconnect related things (GUI quit preferred)"
    fi
}
