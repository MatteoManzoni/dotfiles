# Some library and misc function 

sensors() {
    echo "Temps:"
    echo -e "\tCPU: $(osx-cpu-temp -c)"
    echo -e "\tGPU: $(osx-cpu-temp -g)"
    echo "Fans:"
    echo -e "\t$(osx-cpu-temp -f)"
}

battery() {
    pmset -g batt | egrep "([0-9]+\%).*" -o | awk -F '[" ";]' '{print $1" "$5}'
}

gui_password() {
    if [[ -z $1 ]]; then
        gui_prompt="Password:"
    else
        gui_prompt="$1"
    fi
    PW=$(osascript <<EOF
    tell application "System Events"
        activate
        text returned of (display dialog "${gui_prompt}" default answer "" with hidden answer)
    end tell
EOF
    )

}

vps_vnc_connect() {
    IP="$(keychain -p -s VPS_VNC)"

    open vnc://"$IP"
}

alias lock="/System/Library/CoreServices/Menu\ Extras/User.menu/Contents/Resources/CGSession -suspend"

elmvpn() {
    local PIDFILE_ELMVPN="/tmp/.elmvpn.pid"
    
    if [ "$#" -eq 1 ]; then
        if [ -f "$PIDFILE_ELMVPN" ]; then
            local PID_ELMVPN="$(/bin/cat $PIDFILE_ELMVPN 2>/dev/null)"
        fi
        if [ "$1" == "start" ];then
            if [ "$PID_ELMVPN" == "" ]; then
                sudo /opt/cisco/anyconnect/bin/vpnagentd
                local PID_ELMVPN=$(ps aux | grep vpnagentd | grep -v grep | awk '{print $2}')
                echo "PID:"
                echo "$PID_ELMVPN" | sudo tee $PIDFILE_ELMVPN
                sudo -u matteo open -a Cisco\ AnyConnect\ Secure\ Mobility\ Client
            else
                echo "Anyconnect trojan vpnagentd already running"
                echo "Just start anyconnect gui or even better, kill the trojan! (PID: $PID_ELMVPN)"
            fi
        elif [ "$1" == "clean" ]; then
            if [ "$PID_ELMVPN" != "" ]; then
                PID_GUI_ELMVPN="$(ps aux | grep 'Cisco AnyConnect Secure Mobility Client' | grep -v grep | awk '{print $2}')"
                kill "$PID_GUI_ELMVPN"
                sudo kill "$PID_ELMVPN"
                sudo rm -f "$PIDFILE_ELMVPN"
                echo "100% Trojan Free"
            else
                echo "Missing process PID, maybe already killed?"
            fi
        fi
    else
        echo -e "This command accept:\n\tstart -> start anyconnect VPN trojan and track is PID\n\tclean -> kills the trojan and all anyconnect related things (GUI quit preferred)"
    fi
}

hide() {
    osascript -e "tell application \"Finder\"" -e "set visible of process \"$1\" to false" -e "end tell"
}

TB_connect() {
    osascript -e "tell application \"Tunnelblick\"" -e "connect \"$1\"" -e "end tell"
}

TB_disconnect() {
    osascript -e "tell application \"Tunnelblick\"" -e "disconnect all" -e "end tell"
}

coreaudiokill() {
    sudo killall coreaudiod
}
